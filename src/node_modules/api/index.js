import R from 'ramda';
import axios from 'axios';
import phones from './mockPhones';
import categories from './mockCategories';

let dataItems = [];
function transform(ph) {
    ph = ph['data']['feed']['entry'];
    // ph = ph['feed']['entry'];
    for (let key in ph) {
        let id = ph[key]['gsx$id']['$t'];
        dataItems[id] = {};
        dataItems[id].id = ph[key]['gsx$id']['$t'];
        dataItems[id].category = ph[key]['gsx$category']['$t'];
        dataItems[id].categoryId = ph[key]['gsx$categoryid']['$t'];
        dataItems[id].name = ph[key]['gsx$name']['$t'];
        dataItems[id].price = ph[key]['gsx$price']['$t'];
        dataItems[id].qty = ph[key]['gsx$qty']['$t'];
        dataItems[id].image = ph[key]['gsx$image']['$t'];
        dataItems[id].info = ph[key]['gsx$info']['$t'];
    }
    return dataItems
}
// transform(phones)

export const storePhones = dataItems;

// export const fetchPhones = async () => {
//     return new Promise( (resolve, reject) => {
//         resolve(dataItems)
//         reject('error');
//     })
// }

export const fetchPhones = async () => {
    return axios.get('https://spreadsheets.google.com/feeds/list/14TLc0l5UugaJjcS_Ch8OCCRjiJ5yDAI2KtrwAoSseDQ/od6/public/values?alt=json')
        .then(function (response) {
            return transform(response)
        })
        .catch(function (error) {
        console.log(error);
    })
}

// export const loadMorePhones = async ({offset}) => {
//     return new Promise( (resolve, reject) => {
//         resolve(R.slice(offset, offset*2, dataItems));
//         reject('error');
//     })
// }

export const fetchPhoneById = async id => {
    return new Promise( (resolve, reject) => {
        // here is one item from database
        const phone = R.find(R.propEq('id', id), dataItems)
        resolve(phone)
        reject('error');
    })
}

export const fetchCategories = async () => {
    return new Promise( (resolve, reject) => {
        resolve(categories)
        reject('error');
    })
}